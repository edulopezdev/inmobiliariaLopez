@model InmobiliariaLopez.Models.Usuario

@{
  ViewData["Title"] = "Editar Usuario";
}

<!-- Título -->
<h1 class="mb-4 text-center" style="font-family: 'Roboto', sans-serif; font-size: 2rem; color: #343a40;">Editar Usuario
</h1>

<!-- Card para envolver el formulario -->
<div class="card shadow-lg border-0 rounded-4">
  <div class="card-header bg-gradient text-dark border-0 rounded-4">
    <h5 class="mb-0" style="font-family: 'Roboto', sans-serif; font-size: 1.25rem;">Modificar datos del Usuario</h5>
  </div>
  <div class="card-body" style="padding: 1.5rem;">

    <form asp-action="Edit" method="post" enctype="multipart/form-data">
      @Html.AntiForgeryToken()
      <input type="hidden" asp-for="IdUsuario" />

      <div class="form-group mb-3">
        <label asp-for="Email" class="control-label"></label>
        <input asp-for="Email" class="form-control" />
        <span asp-validation-for="Email" class="text-danger"></span>
      </div>

      <!-- Campo para modificar la contraseña -->
      <div class="form-group mb-3">
        <label for="NuevaContrasena">Nueva contraseña (opcional)</label>
        <input asp-for="NuevaContrasena" type="password" class="form-control" />
        <span asp-validation-for="NuevaContrasena" class="text-danger"></span>
      </div>

      <!-- Campo para modificar la Rol -->
      <div class="form-group mb-3">
        <label asp-for="Rol" class="control-label"></label>

        @if (User.IsInRole("Administrador") && Model.IdUsuario != Convert.ToInt32(User.FindFirst("IdUsuario")?.Value))
        {
          <!-- Si el usuario es un administrador y no es el propio usuario logueado, mostramos el rol como un select -->
          <select asp-for="Rol" class="form-control">
            <option value="Administrador" @(Model.Rol == "Administrador" ? "selected" : "")>Administrador</option>
            <option value="Empleado" @(Model.Rol == "Empleado" ? "selected" : "")>Empleado</option>
          </select>
        }
        else
        {
          <!-- Si el usuario es un empleado, o está editando su propio perfil, mostramos el rol como texto (solo lectura) -->
          <input asp-for="Rol" class="form-control" disabled />
        }

        <span asp-validation-for="Rol" class="text-danger"></span>
      </div>


      <div class="form-group mb-3">
        <label for="Avatar">Actualizar Avatar (opcional)</label>
        <input type="file" name="Avatar" class="form-control" />
      </div>

      <!-- Botón Guardar -->
      <div class="card-footer d-flex justify-content-end mt-3">
        <button type="submit" class="btn btn-primary btn-sm me-2">Guardar cambios</button>
        <a href="@Url.Action("Index")" class="btn btn-secondary btn-sm">Cancelar</a>
      </div>
    </form>
  </div>
</div>

@section Scripts {
  @await Html.PartialAsync("_ValidationScriptsPartial")
}
